var KonnektMP=function(){var w=function(w){return function(){function e(a){document.createDocumentFragment();this.name=a.tagName.toLowerCase();this.template=x[this.name]||'<div class="missing_component">Unknown Component</div>';this.node=a;this.fragment=document.createDocumentFragment();this.wrapper=this.fragment.appendChild(document.createElement("div"));this.wrapper.className="Wrapper Wrapper__"+this.name}function h(a,d,b,f){return{value:a,writable:!!d,enumerable:!!f,configurable:!!b}}function A(){return new RegExp("(\\"+
q.split("").join("\\")+")(.*?)(\\"+v.split("").join("\\")+")","g")}function B(a){return a.split(new RegExp("("+q.split("").join("\\")+")(.*?)("+v.split("").join("\\")+")","g")).map(function(a,b,f){return f[b-1]===q?q+a+v:a}).filter(function(a,b,f){return 0!==a.length&&a!==q&&a!==v&&0!==a.length})}function C(a){return a.replace(new RegExp("["+q+v+"]","g"),"").replace(new RegExp("(\\"+r.split("").join("\\")+"(.*?)+)","g"),"").replace(/\s/g,"")}function H(a){return a.reduce(function(a,b){b.match(/(\()(.*?)(\))/)?
a.vmFilters[a.vmFilters.length]=b.replace(/[\(\)]/g,""):b.match(/(\[)(.*?)(\])/)?-1!==b.indexOf("~")?a.model[a.model.length]=b.replace(/[\[\]\~]/g,""):-1!==b.indexOf("+")?a.local[a.local.length]=b.replace(/[\[\]\+]/g,""):a.session[a.session.length]=b.replace(/[\[\]\-]/g,""):a.filters[a.filters.length]=b;return a},{filters:[],vmFilters:[],model:[],local:[],session:[]})}function D(a){return-1!==a.indexOf("for")?a.replace(new RegExp("["+q+v+"]","g"),"").replace(/\|(.*)/,"").replace(/\s/g,"").split(/for(.*?)loop/).filter(function(a){return 0!==
a.length}):[]}function I(a){if(2>a.split("==").length&&2>a.split("<=").length&&2>a.split(">=").length&&-1!==a.indexOf("="))return a.substring(a.indexOf("=")+1,a.length)}function J(a){var d=a.match(/^(\s*)(>)((.*?)+)/),b=a.match(/^(\s*)(<)((.*?)+)/);a=a.replace(/(^<|^>)((.*?)+)/,"$2");var f=I(a),k=a.match(/((==|<=|>=|<|>)((.*?)+))/g),e=a.match(/(([\+\*-\/])((.*?)+))/g);return{type:d?"insert":b?"outsert":void 0,set:f!==a?f:void 0,filters:k||e?{boolFilter:k?eval("(function(){ return function(v){ return (v"+
k[0]+");};}())"):void 0,mathFilter:e?eval("(function(){ return function(v){ return (v"+e[0]+");};}())"):void 0}:void 0}}function E(a){if(0!==a.length){for(var d="",b=0,f=a.length;b<f;b++)if("string"===typeof a[b])d+=a[b];else if(void 0===a[b]._data)d+=a[b].text;else var k=a[b]._data.get(a[b].key),d=d+z(void 0!==k?k:"",a[b].filters.filters,a[b]._data.filters);return d}return z(a[0]._data.get(a[0].key)||"",a[0].filters.filters,a[0]._data.filters)}function z(a,d,b){for(var f=0,k=d.length;f<k;f++)b[d[f]]&&
(a=b[d[f]](a));return a}function F(a,d,b,f){for(var k=0,e=d.length;k<e;k++)if(b[d[k]])b[d[k]](a,f);return a}function G(){function a(a,b){var c=J(b);this.text=a;this.key=b.replace(/(^>|^<*)(.*?)([=*+-\/<>]+)((.*?)+)/g,"$2").replace(/\s/g,"");this.keyLength=this.key.split(".").length;this.localKey=this.key.split(".").pop();var d;d=-1!==a.indexOf(r)?a.replace(new RegExp("["+v+"]","g"),"").replace(new RegExp("(.*?)(\\"+r.split("").join("\\")+")"),"").replace(/\s/g,"").split(","):[];this.filters=H(d);
this.component="for"===this.type?D(a)[1]:void 0;this.id=0;this.subType=c.subtype;this.set=c.set;this.inlineFilters=c.filters}function d(a,b){for(var c=0,d=b.length;c<d;c++)a.stopChange().appendChild(b[c])}function b(a){if(a&&window.model)return window.model.get(a[0])}function f(a,b){if(b&&0!==b.length&&window.model)for(var c=0,d=b.length;c<d;c++)window.model.set(b[c],a)}function k(a){if(a&&window.localStorage)return localStorage.getItem(a[0])}function e(a,b){if(a&&0!==a.length&&window.localStorage)for(var c=
0,d=a.length;c<d;c++)localStorage.setItem(a[c],b)}function m(a){if(a&&window.sessionStorage)return sessionStorage.getItem(a[0])}function n(a,b){if(a&&0!==a.length&&window.sessionStorage)for(var c=0,d=a.length;c<d;c++)sessionStorage.setItem(a[c],b)}Object.defineProperties(a.prototype,{addPointer:h(function(a){for(var b=document.createElement(this.component),c=F(this._data.getLayer(this.key),this.filters.filters,this._data.filters,a)[a],d=0,f=Object.keys(c,"all"),g=f.length;d<g;d++)b.k_post||(b.k_post=
{}),b.k_post[f[d]]=c,b.k_post.x=a,b.k_post.loopid=this.component+"_"+a;a>=this.node.children.length?this.node.stopChange().appendChild(b):this.node.stopChange().insertBefore(b,this.node.children[a]);a={event:"loopitem",node:b,parent:this.node};b=p[a.event];c=0;for(d=b.length;c<d;c++)b[c](a);return this}),removePointer:h(function(a){for(var b=this.node.children[a].kb_maps,c=0,d=Object.keys(this.node.children[a].kb_viewmodel.pointers),f=d.length;c<f;c++){var g=b[d[c]];if(g)for(var e=0,k=g.length;e<
k;e++)g[e].unsync(),g[e]=null,delete g[e]}this.node.stopChange().removeChild(this.node.children[a]);c=0;for(f=this.node.children.length;c<f;c++)this.node.children[c].kb_viewmodel.x=c,a=this.node.children[c].kb_viewmodel.loopid,this.node.children[c].kb_viewmodel.loopid=a.substring(0,a.lastIndexOf("_")+1)+c;return this}),reapplyPointer:h(function(a){for(var b=this.node.children[a].kb_maps,c=this.node.children[a].kb_viewmodel.loopid,d=0,f=Object.keys(this.node.children[a].kb_viewmodel.pointers),g=f.length;d<
g;d++){var e=b[f[d]];if(void 0!==e)for(var k=0,h=e.length;k<h;k++)e[k].reconnect()}this.node.children[a].kb_viewmodel.x=a;this.node.children[a].kb_viewmodel.loopid=c.substring(0,c.lastIndexOf("_")+1)+a;return this}),connect:h(function(a){var f=this;this._data=a;if("for"!==this.type){if(this.insert){this.setDom(this._data.get(this.key));this.unsync();return}if(this.set){var c=!isNaN(parseInt(this.set,10))&&parseInt(this.set,10).toString().length===this.set.length,e="true"===this.set.replace(/\s/g,
"")||"false"===this.set.replace(/\s/g,""),h=-1!==this.set.indexOf('"')||-1!==this.set.indexOf("'");(this.set=c?parseInt(this.set,10):e?"true"===this.set.replace(/\s/g,""):h?this.set.replace(/((\s*\"|\')(.*?)(\"|\'))/g,"$3"):void 0)&&this._data.set(this.key,this.set)}if(this.outsert){this.setDom("");this.unsync();return}this.inlineFilters&&(this.inlineFilters.boolFilter?(this.filters.filters.unshift("boolFilter"),this._data.filters.boolFilter=this.inlineFilters.boolFilter):(this.filters.filters.unshift("mathFilter"),
this._data.filters.mathFilter=this.inlineFilters.mathFilter));this.dataListener=function(a){"delete"===a.event?f.unsync():f.setDom(a.value)};a.getLayer(this.key).addDataUpdateListener(this.localKey,this.dataListener);1===this.bindText.length&&(this.domListener=function(a){f.setData(a.value)},this.node.addAttrUpdateListener(this.listener,this.domListener))}else this.dataListener=function(a){"postset"!==a.type||a.oldValue&&0!==a.oldValue.length||(a.event="create");f.setLoop(a.key,a.event)},a.getLayer(this.key).addDataMethodUpdateListener(this.dataListener);
"for"!==this.type&&(this.filters.model&&0!==this.filters.model.length?this._data.stopChange().set(this.key,b(this.filters.model)):this.filters.session&&0!==this.filters.session.length?this._data.stopChange().set(this.key,m(this.filters.session)):this.filters.local&&0!==this.filters.local.length&&this._data.stopChange().set(this.key,k(this.filters.local)),this.isEvent?this.node.stopChange()[this.attr]=this._data.get(this.key):"innerHTML"===this.key?(this.node.stopChange().innerHTML="",d(this.node,
this._data.innerHTML)):(this.local.stopChange()[this.localAttr]=E(this.bindText),this.isInput&&-1!==["value","checked"].indexOf(this.attr)&&(a=this._data.get(this.key),this.node.stopChange()[this.attr]=void 0!==a?a:"")));return this}),reconnect:h(function(){"for"!==this.type?(this._data.getLayer(this.key).removeDataUpdateListener(this.localKey,this.dataListener),1===this.bindText.length&&this.node.removeAttrUpdateListener(this.listener,this.domListener)):this._data.getLayer(this.key).removeDataMethodUpdateListener(this.extraListener);
this.connect(this._data);return this}),createloop:h(function(){this.node.stopChange().innerHTML="";for(var a=0,b=F(this._data.get(this.key),this.filters.filters,this._data.filters).length;a<b;a++)this.setLoop(a,"create");return this}),setData:h(function(a){a=z(a,this.filters.vmFilters,this._data.filters);this._data.stopChange().set(this.key,a);f(this.filters.model,a);n(this.filters.session,a);e(this.filters.local,a);return this}),setDom:h(function(a){f(this.filters.model,a);n(this.filters.session,
a);e(this.filters.local,a);this.isEvent?this.node.stopChange()[this.attr]=this._data.get(this.key):this.isInput&&-1!==["value","checked"].indexOf(this.attr)?this.node.stopChange()[this.attr]=this._data.get(this.key):"innerHTML"===this.key?(this.node.stopChange().innerHTML="",d(this.node,this._data.innerHTML)):(this.local.stopChange()[this.localAttr]=E(this.bindText),this.isInput&&-1!==["value","checked"].indexOf(this.attr)&&(a=this._data.get(this.key),this.node.stopChange()[this.attr]=void 0!==a?
a:""));return this}),setLoop:h(function(a,b){switch(b){case "create":this.addPointer(a);break;case "delete":this.removePointer(a);break;case "set":this.reapplyPointer(a);break;default:if("push"!==b)for(var c=0,d=this._data.getLayer(this.key).length;c<d;c++)this.reapplyPointer(c)}return this}),bindMaps:h([]),unsync:h(function(){this._data=this.__proto__.bindText=null;delete this._data;this.bindMaps=null;delete this.bindMaps;this.binds=null;delete this.binds;return this}),reset:h(function(){"for"===
this.type?this._data.getLayer(this.key).removeDataMethodUpdateListener(this.extraListener).addDataMethodUpdateListener(this.extraListener):(this._data.getLayer(this.key).removeDataUpdateListener(this.localKey,this.dataListener).addDataUpdateListener(this.localKey,this.dataListener),1===this.bindText.length&&this.node.removeAttrUpdateListener(this.listener,this.domListener).addAttrUpdateListener(this.listener,this.domListener))})});return a}var q="{{",v="}}",r="|",x={},K=/(<\/.*?>)/g;w().call();var L=
Object.keys(HTMLElement.prototype).filter(function(a){return 0===a.indexOf("on")}),p={loopitem:[]};e.start=function(a){if(void 0===a)return q;q="string"===typeof a?a:q;return e};e.end=function(a){if(void 0===a)return v;v="string"===typeof a?a:v;return e};e.pipe=function(a){if(void 0===a)return r;r="string"===typeof a?a:r;return e};e.getUnknown=function(a){var d=a.match(K).map(function(a){return a.replace(/[<\/>]/g,"")});d.filter(function(a,f){return document.createElement(a)instanceof HTMLUnknownElement&&
-1===d.indexOf(a,f+1)&&void 0===x[a]});return d};e.isRegistered=function(a){return void 0!==x[a]};e.register=function(a,d){void 0===x[a]?(x[a]=d,e.getUnknown(d)):console.error("Class: KonnektMP Method: 'register', A template by the name %o already exists",a);return this};e.addEventListener=function(a,d){void 0!==p[a]?p[a].push(d):console.error("Class: KonnektMP Method: 'addEventListener', No event exists with the name %o",a);return e};e.removeEventListener=function(a,d){if(void 0!==p[a])for(var b=
0,f=p[a].length;b<f;b++)p[a][b].toString()===d.toString()&&p[a].splice(b,1);else console.error("Class: KonnektMP Method: 'removeEventListener', No event exists with the name %o",a);return e};Object.defineProperties(e.prototype,{register:h(e.register),isRegistered:h(e.isRegistered),getUnknown:h(e.getUnknown),map:h(function(a){function d(b,f){for(var e=0,h=b.length;e<h;e++)if(void 0===b[e].kb_maps&&8!==b[e].nodeType){b[e].kb_mapper=a;b[e].kb_maps=f;if(3===b[e].nodeType){var m=b[e],n=f,l=m.textContent;
if(l.match(A())){var t=B(l),c=G();c.prototype.type=l.match(new RegExp("(\\"+q.split("").join("\\")+")(.*?)(for)(.*?)(loop)(.*?)(\\"+v.split("").join("\\")+")","g"))?"for":"text";c.prototype.text=l;c.prototype.bindText=t;c.prototype.listener="textContent";c.prototype.attr="textContent";c.prototype.localAttr="textContent";c.prototype.local=m;c.prototype.node=m.parentElement;c.prototype.binds=n;m=0;for(l=t.length;m<l;m++)if(0===t[m].indexOf(q)){var p="for"===c.prototype.type?D(t[m])[0]:C(t[m]),u=new c(t[m],
p);void 0===n[p]&&(n[p]=[]);u.bindText[m]=u;u.bindMaps.push(u);u.id=n[p].length;n[p].push(u)}}}else for(n=b[e],t=f,c=Array.prototype.slice.call(n.attributes),m=n instanceof HTMLUnknownElement,l=0,p=c.length;l<p;l++)if(c[l].value.match(A())){var u=B(c[l].value),g=G();g.prototype.type=m?"component":"attribute";g.prototype.text=c[l].value;g.prototype.bindText=u;g.prototype.isEvent=-1!==L.indexOf(c[l].name);g.prototype.isInput="input"===n.tagName.toLowerCase();g.prototype.isRadio=g.prototype.isInput?
-1!==["radio","checkbox"].indexOf(n.type):!1;g.prototype.listener=c[l].name;g.prototype.attr=c[l].name;g.prototype.localAttr="value";g.prototype.local=c[l];g.prototype.node=n;g.prototype.binds=t;g.prototype.isEvent&&n.removeAttribute(c[l].name);for(var r=0,x=u.length;r<x;r++)if(0===u[r].indexOf(q)){var w=C(u[r]),y=new g(u[r],w);void 0===t[w]&&(t[w]=[]);y.bindText[r]=y;y.bindMaps.push(y);y.id=t[w].length;t[w].push(y)}}b[e].childNodes&&0!==b[e].childNodes.length&&(f=d(b[e].childNodes,f))}return f}return d(a.childNodes,
{})}),insert:h(e.insert)});return e}}(Createkb);"undefined"!==typeof window&&"undefined"!==typeof window.define&&"undefined"!==typeof window.require?define([],function(){return w}):"undefined"!==typeof module&&(module.exports=w);return w}();
