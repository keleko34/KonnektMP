var KonnektMP=function(){var z=function(z){return function(){function d(a){document.createDocumentFragment();this.name=a.tagName.toLowerCase();this.template=v[this.name]||'<div class="missing_component">Unknown Component</div>';this.node=a;this.fragment=document.createDocumentFragment();this.wrapper=this.fragment.appendChild(document.createElement("div"));this.wrapper.className="Wrapper Wrapper__"+this.name}function k(a,e,b,f){return{value:a,writable:!!e,enumerable:!!f,configurable:!!b}}function B(){return new RegExp("(\\"+
m.split("").join("\\")+")(.*?)(\\"+w.split("").join("\\")+")","g")}function C(a){return a.split(new RegExp("("+m.split("").join("\\")+")(.*?)("+w.split("").join("\\")+")","g")).map(function(a,b,f){return f[b-1]===m?m+a+w:a}).filter(function(a,b,f){return 0!==a.length&&a!==m&&a!==w&&0!==a.length})}function D(a){return a.replace(new RegExp("["+m+w+"]","g"),"").replace(new RegExp("\\"+x.split("").join("\\")+"(.*)"),"")}function I(a){return a.reduce(function(a,b){b.match(/(\()(.*?)(\))/)?a.vmFilters[a.vmFilters.length]=
b.replace(/[\(\)]/g,""):b.match(/(\[)(.*?)(\])/)?-1!==b.indexOf("~")?a.model[a.model.length]=b.replace(/[\[\]\~]/g,""):-1!==b.indexOf("+")?a.local[a.local.length]=b.replace(/[\[\]\+]/g,""):a.session[a.session.length]=b.replace(/[\[\]\-]/g,""):a.filters[a.filters.length]=b;return a},{filters:[],vmFilters:[],model:[],local:[],session:[]})}function E(a){return-1!==a.indexOf("for")?a.replace(new RegExp("["+m+w+"]","g"),"").replace(/\|(.*)/,"").replace(/\s/g,"").split(/for(.*?)loop/).filter(function(a){return 0!==
a.length}):[]}function J(a){if(2>a.split("==").length&&2>a.split("<=").length&&2>a.split(">=").length&&-1!==a.indexOf("="))return a.substring(a.indexOf("=")+1,a.length)}function K(a){var e=a.match(/^(\s*)(>)((.*?)+)/),b=a.match(/^(\s*)(<)((.*?)+)/);a=a.replace(/(^<|^>)((.*?)+)/,"$2");var f=J(a),n=a.match(/((==|<=|>=|<|>)((.*?)+))/g),d=a.match(/(([\+\*-\/])((.*?)+))/g);return{type:e?"insert":b?"outsert":void 0,set:f!==a?f:void 0,filters:n||d?{boolFilter:n?eval("(function(){ return function(v){ return (v"+
n[0]+");};}())"):void 0,mathFilter:d?eval("(function(){ return function(v){ return (v"+d[0]+");};}())"):void 0}:void 0}}function F(a){if(0!==a.length){for(var e="",b=0,f=a.length;b<f;b++)e="string"===typeof a[b]?e+a[b]:void 0===a[b]._data?e+a[b].text:e+A(a[b]._data.get(a[b].key),a[b].filters.filters,a[b]._data.filters);return e}return A(a[0]._data.get(a[0].key),a[0].filters.filters,a[0]._data.filters)}function A(a,e,b){for(var f=0,n=e.length;f<n;f++)b[e[f]]&&(a=b[e[f]](a));return a}function G(a,e,
b,f){for(var n=0,d=e.length;n<d;n++)if(b[e[n]])b[e[n]](a,f);return a}function H(){function a(a,b){var c=K(b);this.text=a;this.key=b.replace(/(^>|^<*)(.*?)([=*+-\/<>]+)((.*?)+)/g,"$2").replace(/\s/g,"");this.keyLength=this.key.split(".").length;this.localKey=this.key.split(".").pop();var g;g=-1!==a.indexOf(x)?a.replace(new RegExp("["+w+"]","g"),"").replace(new RegExp("(.*?)(\\"+x.split("").join("\\")+")"),"").replace(/\s/g,"").split(","):[];this.filters=I(g);this.component="for"===this.type?E(a)[1]:
void 0;this.id=0;this.subType=c.subtype;this.set=c.set;this.inlineFilters=c.filters}function e(a,b){for(var c=0,g=b.length;c<g;c++)a.stopChange().appendChild(b[c])}function b(a){if(a&&window.model)return window.model.get(a[0])}function f(a,b){if(b&&0!==b.length&&window.model)for(var c=0,g=b.length;c<g;c++)window.model.set(b[c],a)}function d(a){if(a&&window.localStorage)return localStorage.getItem(a[0])}function m(a,b){if(a&&0!==a.length&&window.localStorage)for(var c=0,g=a.length;c<g;c++)localStorage.setItem(a[c],
b)}function p(a){if(a&&window.sessionStorage)return sessionStorage.getItem(a[0])}function q(a,b){if(a&&0!==a.length&&window.sessionStorage)for(var c=0,g=a.length;c<g;c++)sessionStorage.setItem(a[c],b)}Object.defineProperties(a.prototype,{addPointer:k(function(a){for(var b=document.createElement(this.component),c=G(this._data.getLayer(this.key),this.filters.filters,this._data.filters,a)[a],g=0,e=Object.keys(c,"all"),h=e.length;g<h;g++)b.k_post||(b.k_post={}),b.k_post[e[g]]=c,b.k_post.x=a,b.k_post.loopid=
this.component+"_"+a;a>=this.node.children.length?this.node.stopChange().appendChild(b):this.node.stopChange().insertBefore(b,this.node.children[a]);a={event:"loopitem",node:b,parent:this.node};b=r[a.event];c=0;for(g=b.length;c<g;c++)b[c](a);return this}),removePointer:k(function(a){for(var b=this.node.children[a].kb_maps,c=0,e=Object.keys(this.node.children[a].kb_viewmodel.pointers),f=e.length;c<f;c++){var h=b[e[c]];if(h)for(var d=0,n=h.length;d<n;d++)h[d].unsync(),h[d]=null,delete h[d]}this.node.stopChange().removeChild(this.node.children[a]);
c=0;for(f=this.node.children.length;c<f;c++)this.node.children[c].kb_viewmodel.x=c,a=this.node.children[c].kb_viewmodel.loopid,this.node.children[c].kb_viewmodel.loopid=a.substring(0,a.lastIndexOf("_")+1)+c;return this}),reapplyPointer:k(function(a){for(var b=this.node.children[a].kb_maps,c=this.node.children[a].kb_viewmodel.loopid,e=0,d=Object.keys(this.node.children[a].kb_viewmodel.pointers),h=d.length;e<h;e++){var f=b[d[e]];if(void 0!==f)for(var n=0,k=f.length;n<k;n++)f[n].reconnect()}this.node.children[a].kb_viewmodel.x=
a;this.node.children[a].kb_viewmodel.loopid=c.substring(0,c.lastIndexOf("_")+1)+a;return this}),connect:k(function(a){var f=this;this._data=a;if("for"!==this.type){if(this.insert){this.setDom(this._data.get(this.key));this.unsync();return}if(this.set){var c=!isNaN(parseInt(this.set,10))&&parseInt(this.set,10).toString().length===this.set.length,g="true"===this.set.replace(/\s/g,"")||"false"===this.set.replace(/\s/g,""),k=-1!==this.set.indexOf('"')||-1!==this.set.indexOf("'");(this.set=c?parseInt(this.set,
10):g?"true"===this.set.replace(/\s/g,""):k?this.set.replace(/((\s*\"|\')(.*?)(\"|\'))/g,"$3"):void 0)&&this._data.set(this.key,this.set)}if(this.outsert){this.setDom("");this.unsync();return}this.inlineFilters&&(this.inlineFilters.boolFilter?(this.filters.filters.unshift("boolFilter"),this._data.filters.boolFilter=this.inlineFilters.boolFilter):(this.filters.filters.unshift("mathFilter"),this._data.filters.mathFilter=this.inlineFilters.mathFilter));this.dataListener=function(a){"delete"===a.event?
f.unsync():f.setDom(a.value)};a.getLayer(this.key).addDataUpdateListener(this.localKey,this.dataListener);1===this.bindText.length&&(this.domListener=function(a){f.setData(a.value)},this.node.addAttrUpdateListener(this.listener,this.domListener))}else this.dataListener=function(a){"postset"!==a.type||a.oldValue&&0!==a.oldValue.length||(a.event="create");f.setLoop(a.key,a.event)},a.getLayer(this.key).addDataMethodUpdateListener(this.dataListener);"for"!==this.type&&(this.filters.model&&0!==this.filters.model.length?
this._data.stopChange().set(this.key,b(this.filters.model)):this.filters.session&&0!==this.filters.session.length?this._data.stopChange().set(this.key,p(this.filters.session)):this.filters.local&&0!==this.filters.local.length&&this._data.stopChange().set(this.key,d(this.filters.local)),this.isEvent?this.node.stopChange()[this.attr]=this._data.get(this.key):"innerHTML"===this.key?(this.node.stopChange().innerHTML="",e(this.node,this._data.innerHTML)):(this.local.stopChange()[this.localAttr]=F(this.bindText),
this.isInput&&-1!==["value","checked"].indexOf(this.attr)&&(this.node.stopChange()[this.attr]=this._data.get(this.key))));return this}),reconnect:k(function(){"for"!==this.type?(this._data.getLayer(this.key).removeDataUpdateListener(this.localKey,this.dataListener),1===this.bindText.length&&this.node.removeAttrUpdateListener(this.listener,this.domListener)):data.getLayer(this.key).removeDataMethodUpdateListener(this.extraListener);this.connect(this._data);return this}),createloop:k(function(){this.node.stopChange().innerHTML=
"";for(var a=0,b=G(this._data.get(this.key),this.filters.filters,this._data.filters).length;a<b;a++)this.setLoop(a,"create");return this}),setData:k(function(a){a=A(a,this.filters.vmFilters,this._data.filters);this._data.stopChange().set(this.key,a);f(this.filters.model,a);q(this.filters.session,a);m(this.filters.local,a);return this}),setDom:k(function(a){f(this.filters.model,a);q(this.filters.session,a);m(this.filters.local,a);this.isEvent?this.node.stopChange()[this.attr]=this._data.get(this.key):
this.isInput&&-1!==["value","checked"].indexOf(this.attr)?this.node.stopChange()[this.attr]=this._data.get(this.key):"innerHTML"===this.key?(this.node.stopChange().innerHTML="",e(this.node,this._data.innerHTML)):this.local.stopChange()[this.localAttr]=F(this.bindText);return this}),setLoop:k(function(a,b){switch(b){case "create":this.addPointer(a);break;case "delete":this.removePointer(a);break;case "set":this.reapplyPointer(a);break;default:if("push"!==b)for(var c=0,e=this._data.getLayer(this.key).length;c<
e;c++)this.reapplyPointer(c)}return this}),bindMaps:k([]),unsync:k(function(){this._data=this.__proto__.bindText=null;delete this._data;this.bindMaps=null;delete this.bindMaps;this.binds=null;delete this.binds;return this})});return a}var m="{{",w="}}",x="|",v={},L=/(<\/.*?>)/g;z().call();var M=Object.keys(HTMLElement.prototype).filter(function(a){return 0===a.indexOf("on")}),r={loopitem:[]};d.start=function(a){if(void 0===a)return m;m="string"===typeof a?a:m;return d};d.end=function(a){if(void 0===
a)return w;w="string"===typeof a?a:w;return d};d.pipe=function(a){if(void 0===a)return x;x="string"===typeof a?a:x;return d};d.getUnknown=function(a){var e=a.match(L).map(function(a){return a.replace(/[<\/>]/g,"")});e.filter(function(a,f){return document.createElement(a)instanceof HTMLUnknownElement&&-1===e.indexOf(a,f+1)&&void 0===v[a]});return e};d.isRegistered=function(a){return void 0!==v[a]};d.register=function(a,e){void 0===v[a]?(v[a]=e,d.getUnknown(e)):console.error("Class: KonnektMP Method: 'register', A template by the name %o already exists",
a);return this};d.addEventListener=function(a,e){void 0!==r[a]?r[a].push(e):console.error("Class: KonnektMP Method: 'addEventListener', No event exists with the name %o",a);return d};d.removeEventListener=function(a,e){if(void 0!==r[a])for(var b=0,f=r[a].length;b<f;b++)r[a][b].toString()===e.toString()&&r[a].splice(b,1);else console.error("Class: KonnektMP Method: 'removeEventListener', No event exists with the name %o",a);return d};Object.defineProperties(d.prototype,{register:k(d.register),isRegistered:k(d.isRegistered),
getUnknown:k(d.getUnknown),map:k(function(a){function e(b,f){for(var d=0,k=b.length;d<k;d++)if(void 0===b[d].kb_maps&&8!==b[d].nodeType){b[d].kb_mapper=a;b[d].kb_maps=f;if(3===b[d].nodeType){var p=b[d],q=f,l=p.textContent;if(l.match(B())){var t=C(l),c=H();c.prototype.type=l.match(new RegExp("(\\"+m.split("").join("\\")+")(.*?)(for)(.*?)(loop)(.*?)(\\"+w.split("").join("\\")+")","g"))?"for":"text";c.prototype.text=l;c.prototype.bindText=t;c.prototype.listener="textContent";c.prototype.attr="textContent";
c.prototype.localAttr="textContent";c.prototype.local=p;c.prototype.node=p.parentElement;c.prototype.binds=q;p=0;for(l=t.length;p<l;p++)if(0===t[p].indexOf(m)){var g="for"===c.prototype.type?E(t[p])[0]:D(t[p]),u=new c(t[p],g);void 0===q[g]&&(q[g]=[]);u.bindText[p]=u;u.bindMaps.push(u);u.id=q[g].length;q[g].push(u)}}}else for(q=b[d],t=f,c=Array.prototype.slice.call(q.attributes),p=q instanceof HTMLUnknownElement,l=0,g=c.length;l<g;l++)if(c[l].value.match(B())){var u=C(c[l].value),h=H();h.prototype.type=
p?"component":"attribute";h.prototype.text=c[l].value;h.prototype.bindText=u;h.prototype.isEvent=-1!==M.indexOf(c[l].name);h.prototype.isInput="input"===q.tagName.toLowerCase();h.prototype.isRadio=h.prototype.isInput?-1!==["radio","checkbox"].indexOf(q.type):!1;h.prototype.listener=c[l].name;h.prototype.attr=c[l].name;h.prototype.localAttr="value";h.prototype.local=c[l];h.prototype.node=q;h.prototype.binds=t;h.prototype.isEvent&&q.removeAttribute(c[l].name);for(var r=0,x=u.length;r<x;r++)if(0===u[r].indexOf(m)){var v=
D(u[r]),y=new h(u[r],v);void 0===t[v]&&(t[v]=[]);y.bindText[r]=y;y.bindMaps.push(y);y.id=t[v].length;t[v].push(y)}}b[d].childNodes&&0!==b[d].childNodes.length&&(f=e(b[d].childNodes,f))}return f}return e(a.childNodes,{})}),insert:k(d.insert)});return d}}(Createkb);"undefined"!==typeof window&&"undefined"!==typeof window.define&&"undefined"!==typeof window.require?define([],function(){return z}):"undefined"!==typeof module&&(module.exports=z);return z}();
