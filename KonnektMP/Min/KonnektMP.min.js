var KonnektMP=function(){var t=function(t){return function(){function e(a){document.createDocumentFragment();this.name=a.tagName.toLowerCase();this.template=w[this.name]||'<div class="missing_component">Unknown Component</div>';this.node=a;this.fragment=document.createDocumentFragment();this.wrapper=this.fragment.appendChild(document.createElement("div"));this.wrapper.className="Wrapper Wrapper__"+this.name}function f(a,g,b,q){return{value:a,writable:!!g,enumerable:!!q,configurable:!!b}}function E(a,
g,b,q){Object.getOwnPropertyDescriptor(a,g);return{get:function(){return a.get(g)},set:function(g){(this._stopChange?a.stopChange():a).set(prop,g);this._stopChange=!1},configurable:!!b,enumerable:!!q}}function z(){return new RegExp("(\\"+k.split("").join("\\")+")(.*?)(\\"+r.split("").join("\\")+")","g")}function A(a){return a.split(new RegExp("("+k.split("").join("\\")+")(.*?)("+r.split("").join("\\")+")","g")).map(function(a,b,q){return q[b-1]===k?k+a+r:a}).filter(function(a,b,q){return 0!==a.length&&
a!==k&&a!==r&&0!==a.length})}function B(a){return a.replace(new RegExp("["+k+r+"]","g"),"").replace(new RegExp("\\"+u.split("").join("\\")+"(.*)"),"").replace(/\s/g,"")}function F(a){return a.reduce(function(a,b){b.match(/(\()(.*?)(\))/)?a.vmFilters[a.vmFilters.length]=b.replace(/[\(\)]/g,""):b.match(/(\[)(.*?)(\])/)?-1!==b.indexOf("~")?a.model[a.model.length]=b.replace(/[\[\]\~]/g,""):-1!==b.indexOf("+")?a.local[a.local.length]=b.replace(/[\[\]\+]/g,""):a.session[a.session.length]=b.replace(/[\[\]\-]/g,
""):a.filters[a.filters.length]=b;return a},{filters:[],vmFilters:[],model:[],local:[],session:[]})}function C(a){return-1!==a.indexOf("for")?a.replace(new RegExp("["+k+r+"]","g"),"").replace(/\|(.*)/,"").replace(/\s/g,"").split(/for(.*?)loop/).filter(function(a){return 0!==a.length}):[]}function D(){function a(d,a){this.text=d;this.key=a;var c;c=-1!==d.indexOf(u)?d.replace(new RegExp("["+r+"]","g"),"").replace(new RegExp("(.*?)(\\"+u.split("").join("\\")+")"),"").replace(/\s/g,"").split(","):[];
this.filters=F(c);this.component="for"===this.type?C(d)[1]:void 0;this.id=0}function g(d,a,c){return a.reduce(function(d,a){return c[a]?c[a](d):d},d)}function b(d){return d.reduce(function(d,a){return d="object"===typeof a&&a._data?d+g(a.value,a.filters.filters,a._data.filters):d+a},"")}function q(d,a){if(0!==d.length&&window.model)for(var c=0,b=d.length;c<b;c++)window.model.set(d[c],a)}function e(a,l){if(0!==a.length)for(var c=0,b=a.length;c<b;c++)localStorage.setItem(a[c],l)}function k(a,l){if(0!==
a.length)for(var c=0,b=a.length;c<b;c++)sessionStorage.setItem(a[c],l)}Object.defineProperties(a.prototype,{addPointer:f(function(a,b){for(var c=document.createElement(this.component),g=this._data.getLayer(this.key),h=0,e=Object.keys(g[a],"all"),q=e.length;h<q;h++)c.k_post||(c.k_post={},c.k_post.pointers={}),c.k_post.pointers[e[h]]=g[a];a>=this.node.children.length?this.node.appendChild(c):this.node.insertBefore(c,this.node.children[a]);b&&b(c)}),removePointer:f(function(a,b){this.unsync();this.node.removeChild(this.node.children[a]);
b&&b(this.node);this.node=null;delete this.node}),reapplyPointer:f(function(a,b){for(var c=this.node.children[a].kb_viewmodel,g=0,h=Object.keys(this.value[a],"all"),e=h.length;g<e;g++)c.addPointer(this.value,h[g]);b&&b(this.node)}),connect:f(function(a){var b=this;this._data=a;Object.defineProperty(this,"value",E(a,this.key),!0,!0);"for"!==this.type?(this.dataListener=function(a){"delete"===a.event?b.unsync():b.setDom(a.value)},a.getLayer(this.key).addDataUpdateListener(this.key.split(".").pop(),
this.dataListener),1===this.bindText.length&&(this.domListener=function(a){b.setData(a.value)},this.node.addAttrUpdateListener("text"===this.type?"html":this.listener,this.domListener)),this.setDom(a.getLayer(this.key)[this.key.split(".").pop()])):(this.dataListener=function(a){b.setLoop(a.key,a.event)},this.extraListener=function(a){b.setLoop("*","organize")},a.getLayer(this.key).addDataUpdateListener("*",this.dataListener).addDataMethodUpdateListener(this.extraListener),this.node[this.listener]=
"");return this}),setData:f(function(a){a=g(a,this.filters.vmFilters,this._data.filters);this._data.set(this.key,a);q(this.filters.model,a);k(this.filters.session,a);e(this.filters.local,a);return this}),setDom:f(function(a){q(this.filters.model,a);k(this.filters.session,a);e(this.filters.local,a);this.local[this.attr]=b(this.bindText);return this}),setLoop:f(function(a,b,c){switch(b){case "create":this.addPointer(a,c);break;case "delete":this.removePointer(a,c);break;case "set":this.reapplyPointer(a,
c);break;case "organize":for(a=0,b=this.value.length;a<b;a++)this.reapplyPointer(a,c)}return this}),bindMaps:f([]),unsync:f(function(){Object.defineProperty(this,"value",f(void 0,!0,!0,!1));delete this.value;this.__proto__.bindText=null;this.domListener&&(this.node.removeAttrUpdateListener("text"===this.type?"html":this.listener,this.domListener),this.domListener=null,delete this.domListener);this._data.getLayer(this.key).removeDataUpdateListener(this.dataListener);this.extraListener&&this._data.getLayer(this.key).removeMethodUpdateListener(this.extraListener);
this._data=null;delete this._data;this.__proto__.bindMaps.splice(this.bindMapId,1);for(var a=this.bindMapId,b=this.bindMaps.length;a<b;a++)this.__proto__.bindMaps[a].bindMapId=a;this.__proto__.bindMaps=null;delete this.__proto__.bindMaps;this.node=null;delete this.node;this.target=null;delete this.target;this.binds=null;delete this.binds;return this}),loop:f(function(a){for(var b=0,c=this._data.getLayer(this.key).length;b<c;b++)this.setLoop(b,"create",a);return this})});return a}var k="{{",r="}}",
u="|",w={},G=/(<\/.*?>)/g;t().call();var H=Object.keys(HTMLElement.prototype).filter(function(a){return 0===a.indexOf("on")});e.start=function(a){if(void 0===a)return k;k="string"===typeof a?a:k;return e};e.end=function(a){if(void 0===a)return r;r="string"===typeof a?a:r;return e};e.pipe=function(a){if(void 0===a)return u;u="string"===typeof a?a:u;return e};e.getUnknown=function(a){var g=a.match(G).map(function(a){return a.replace(/[<\/>]/g,"")});g.filter(function(a,e){return document.createElement(a)instanceof
HTMLUnknownElement&&-1===g.indexOf(a,e+1)&&void 0===w[a]});return g};e.isRegistered=function(a){return void 0!==w[a]};e.register=function(a,g){void 0===w[a]?(w[a]=g,e.getUnknown(g)):console.error("Class: KonnektMP Method: 'register', A template by the name %o already exists",a);return this};Object.defineProperties(e.prototype,{register:f(e.register),isRegistered:f(e.isRegistered),getUnknown:f(e.getUnknown),map:f(function(a){function g(b,e){for(var f=0,u=b.length;f<u;f++)if(void 0===b[f].kb_maps&&
8!==b[f].nodeType){b[f].kb_mapper=a;b[f].kb_maps=e;if(3===b[f].nodeType){var d=b[f],l=e,c=d.textContent;if(c.match(z())){var m=A(c),h=D();h.prototype.type=c.match(new RegExp("(\\"+k.split("").join("\\")+")(.*?)(for)(.*?)(loop)(.*?)(\\"+r.split("").join("\\")+")","g"))?"for":"text";h.prototype.text=c;h.prototype.bindText=m;h.prototype.listener="textContent";h.prototype.attr="textContent";h.prototype.local=d;h.prototype.node=d.parentElement;h.prototype.binds=l;d=0;for(c=m.length;d<c;d++)if(0===m[d].indexOf(k)){var x=
"for"===h.prototype.type?C(m[d])[0]:B(m[d]),n=new h(m[d],x);void 0===l[x]&&(l[x]=[]);n.bindText[d]=n;n.bindMaps.push(n);n.id=l[x].length;l[x].push(n)}}}else for(l=b[f],m=e,h=Array.prototype.slice.call(l.attributes),d=l instanceof HTMLUnknownElement,c=0,x=h.length;c<x;c++)if(h[c].value.match(z())){var n=A(h[c].value),p=D();p.prototype.type=d?"component":"attribute";p.prototype.text=h[c].value;p.prototype.bindText=n;p.prototype.isEvent=-1!==H.indexOf(h[c].name);p.prototype.isInput="input"===l.tagName.toLowerCase();
p.prototype.listener=h[c].name;p.prototype.attr=h[c].name;p.prototype.local=l;p.prototype.node=l.parentElement;p.prototype.binds=m;p.prototype.isEvent&&l.removeAttribute(h[c].name);for(var y=0,w=n.length;y<w;y++)if(0===n[y].indexOf(k)){var t=B(n[y]),v=new p(n[y],t);void 0===m[t]&&(m[t]=[]);v.bindText[y]=v;v.bindMaps.push(v);v.id=m[t].length;v.bindMapId=v.bindMaps.length-1;m[t].push(v)}}b[f].childNodes&&0!==b[f].childNodes.length&&(e=g(b[f].childNodes,e))}return e}return g(a.childNodes,{})})});return e}}(Createkb);
"undefined"!==typeof window&&"undefined"!==typeof window.define&&"undefined"!==typeof window.require?define([],function(){return t}):"undefined"!==typeof module&&(module.exports=t);return t}();
