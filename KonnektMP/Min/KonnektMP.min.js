var KonnektMP=function(){var r=function(r){return function(){function f(a){document.createDocumentFragment();this.name=a.tagName.toLowerCase();this.template=w[this.name]||'<div class="missing_component">Unknown Component</div>';this.node=a;this.fragment=document.createDocumentFragment();this.wrapper=this.fragment.appendChild(document.createElement("div"));this.wrapper.className="Wrapper Wrapper__"+this.name}function e(a,g,b,t){return{value:a,writable:!!g,enumerable:!!t,configurable:!!b}}function F(a,
g,b,t){Object.getOwnPropertyDescriptor(a,g);return{get:function(){return a.get(g)},set:function(g){(this._stopChange?a.stopChange():a).set(prop,g);this._stopChange=!1},configurable:!!b,enumerable:!!t}}function z(){return new RegExp("(\\"+l.split("").join("\\")+")(.*?)(\\"+q.split("").join("\\")+")","g")}function A(a){return a.split(new RegExp("("+l.split("").join("\\")+")(.*?)("+q.split("").join("\\")+")","g")).map(function(a,b,t){return t[b-1]===l?l+a+q:a}).filter(function(a,b,t){return 0!==a.length&&
a!==l&&a!==q&&0!==a.length})}function B(a){return a.replace(new RegExp("["+l+q+"]","g"),"").replace(new RegExp("\\"+u.split("").join("\\")+"(.*)"),"").replace(/\s/g,"")}function G(a){return a.reduce(function(a,b){b.match(/(\()(.*?)(\))/)?a.vmFilters[a.vmFilters.length]=b.replace(/[\(\)]/g,""):b.match(/(\[)(.*?)(\])/)?-1!==b.indexOf("~")?a.model[a.model.length]=b.replace(/[\[\]\~]/g,""):-1!==b.indexOf("+")?a.local[a.local.length]=b.replace(/[\[\]\+]/g,""):a.session[a.session.length]=b.replace(/[\[\]\-]/g,
""):a.filters[a.filters.length]=b;return a},{filters:[],vmFilters:[],model:[],local:[],session:[]})}function C(a){return-1!==a.indexOf("for")?a.replace(new RegExp("["+l+q+"]","g"),"").replace(/\|(.*)/,"").replace(/\s/g,"").split(/for(.*?)loop/).filter(function(a){return 0!==a.length}):[]}function D(){function a(a,c){this.text=a;this.key=c;var d;d=-1!==a.indexOf(u)?a.replace(new RegExp("["+q+"]","g"),"").replace(new RegExp("(.*?)(\\"+u.split("").join("\\")+")"),"").replace(/\s/g,"").split(","):[];
this.filters=G(d);this.component="for"===this.type?C(a)[1]:void 0;this.id=0}function g(a,c,d){return c.reduce(function(a,E){return d[E]?d[E](a):a},a)}function b(a,c){if(0!==c.length&&window.model)for(var d=0,b=c.length;d<b;d++)window.model.set(c[d],a)}function t(a,c){if(0!==a.length)for(var d=0,b=a.length;d<b;d++)localStorage.setItem(a[d],c)}function f(a,c){if(0!==a.length)for(var d=0,b=a.length;d<b;d++)sessionStorage.setItem(a[d],c)}Object.defineProperties(a.prototype,{addPointer:e(function(a){for(var c=
document.createElement(this.component),d=0,b=Object.keys(this.value[a],"all"),g=b.length;d<g;d++)c.k_post||(c.k_post={},c.k_post.pointers={}),c.k_post.pointers[b[d]]=this.value[a];a>=this.node.children.length?this.node.appendChild(c):this.node.insertBefore(c,this.node.children[a]);return c}),removePointer:e(function(a){this.unsync();this.node.removeChild(this.node.children[a])}),reapplyPointer:e(function(a){var c=this.node.children[a].kb_viewmodel,d=0;a=Object.keys(this.value[a],"all");for(var b=
a.length;d<b;d++)c.addPointer(this.value,a[d])}),connect:e(function(a){var c=this;this._data=a;Object.defineProperty(this,"value",F(a,this.key),!0,!0);"for"!==this.type?(this.dataListener=function(a){"delete"===a.event?c.unsync():c.setDom(a.value)},a.getLayer(this.key).addDataUpdateListener(this.key.split(".").pop(),this.dataListener),1===this.bindText.length&&this.node.addAttrUpdateListener(this.listener,function(a){c.setData(a.value)}),this.setDom(a.getLayer(this.key)[this.key.split(".").pop()])):
(this.dataListener=function(a){c.setLoop(a.key,a.event)},this.extraListener=function(a){c.setLoop("*","organize")},a.getLayer(this.key).addDataUpdateListener("*",this.dataListener).addDataMethodUpdateListener(this.extraListener));return this}),setData:e(function(a){a=g(a,this.filters.vmFilters,this._data.filters);this._data.set(this.key,a);b(this.filters.model,a);f(this.filters.session,a);t(this.filters.local,a);return this}),setDom:e(function(a){b(this.filters.model,a);f(this.filters.session,a);
t(this.filters.local,a);this.local[this.attr]=g(a,this.filters.filters,this._data.filters);return this}),setLoop:e(function(a,c,b){switch(c){case "create":this.addPointer(a,b);case "delete":this.removePointer(a,b);case "set":this.reapplyPointer(a,b);case "organize":for(a=0,c=this.value.length;a<c;a++)this.reapplyPointer(a,b)}return this}),bindMaps:e([]),unsync:e(function(){Object.defineProperty(this,"value",e(void 0,!0,!0,!1));delete this.value;this.__proto__.bindText=null;this._data.getLayer(this.key).removeDataUpdateListener(this.dataListener);
this.extraListener&&this._data.getLayer(this.key).removeMethodUpdateListener(this.extraListener);this._data=null;delete this._data;this.bindMaps.splice(this.bindMapId,1);for(var a=this.bindMapId,b=this.bindMaps.length;a<b;a++)this.bindMaps[a].bindMapId=a;this.bindMaps=null;delete this.bindMaps;this.binds=null;delete this.binds;return this}),loop:e(function(a){for(var b=0,d=this._data.getLayer(this.key).length;b<d;b++)this.setLoop(b,"create",a);return this})});return a}var l="{{",q="}}",u="|",w={},
H=/(<\/.*?>)/g;r().call();var I=Object.keys(HTMLElement.prototype).filter(function(a){return 0===a.indexOf("on")});f.start=function(a){if(void 0===a)return l;l="string"===typeof a?a:l;return f};f.end=function(a){if(void 0===a)return q;q="string"===typeof a?a:q;return f};f.pipe=function(a){if(void 0===a)return u;u="string"===typeof a?a:u;return f};f.getUnknown=function(a){var g=a.match(H).map(function(a){return a.replace(/[<\/>]/g,"")});g.filter(function(a,f){return document.createElement(a)instanceof
HTMLUnknownElement&&-1===g.indexOf(a,f+1)&&void 0===w[a]});return g};f.isRegistered=function(a){return void 0!==w[a]};f.register=function(a,g){void 0===w[a]?(w[a]=g,f.getUnknown(g)):console.error("Class: KonnektMP Method: 'register', A template by the name %o already exists",a);return this};Object.defineProperties(f.prototype,{register:e(f.register),isRegistered:e(f.isRegistered),getUnknown:e(f.getUnknown),map:e(function(a){function g(b,f){for(var e=0,u=b.length;e<u;e++)if(void 0===b[e].kb_maps&&
8!==b[e].nodeType){b[e].kb_mapper=a;b[e].kb_maps=f;if(3===b[e].nodeType){var c=b[e],d=f,k=c.textContent;if(k.match(z())){var m=A(k),h=D();h.prototype.type=k.match(new RegExp("(\\"+l.split("").join("\\")+")(.*?)(for)(.*?)(loop)(.*?)(\\"+q.split("").join("\\")+")","g"))?"for":"text";h.prototype.text=k;h.prototype.bindText=m;h.prototype.listener="textContent";h.prototype.attr="textContent";h.prototype.local=c;h.prototype.node=c.parentElement;h.prototype.binds=d;c=0;for(k=m.length;c<k;c++)if(0===m[c].indexOf(l)){var x=
"for"===h.prototype.type?C(m[c])[0]:B(m[c]),n=new h(m[c],x);void 0===d[x]&&(d[x]=[]);n.bindText[c]=n;n.bindMaps.push(n);n.id=d[x].length;d[x].push(n)}}}else for(d=b[e],m=f,h=Array.prototype.slice.call(d.attributes),c=d instanceof HTMLUnknownElement,k=0,x=h.length;k<x;k++)if(h[k].value.match(z())){var n=A(h[k].value),p=D();p.prototype.type=c?"component":"attribute";p.prototype.text=h[k].value;p.prototype.bindText=n;p.prototype.isEvent=-1!==I.indexOf(h[k].name);p.prototype.isInput="input"===d.tagName.toLowerCase();
p.prototype.listener=h[k].name;p.prototype.attr=h[k].name;p.prototype.local=d;p.prototype.node=d.parentElement;p.prototype.binds=m;p.prototype.isEvent&&d.removeAttribute(h[k].name);for(var y=0,w=n.length;y<w;y++)if(0===n[y].indexOf(l)){var r=B(n[y]),v=new p(n[y],r);void 0===m[r]&&(m[r]=[]);v.bindText[y]=v;v.bindMaps.push(v);v.id=m[r].length;v.bindMapId=v.bindMaps.length-1;m[r].push(v)}}b[e].childNodes&&0!==b[e].childNodes.length&&(f=g(b[e].childNodes,f))}return f}return g(a.childNodes,{})})});return f}}(Createkb);
"undefined"!==typeof window&&"undefined"!==typeof window.define&&"undefined"!==typeof window.require?define([],function(){return r}):"undefined"!==typeof module&&(module.exports=r);return r}();
