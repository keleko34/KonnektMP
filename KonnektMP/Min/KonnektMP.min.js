var KonnektMP=function(){var A=function(A){return function(){function h(a){document.createDocumentFragment();this.name=a.tagName.toLowerCase();this.template=y[this.name]||'<div class="missing_component">Unknown Component</div>';this.node=a;this.fragment=document.createDocumentFragment();this.wrapper=this.fragment.appendChild(document.createElement("div"));this.wrapper.className="Wrapper Wrapper__"+this.name;if(this.template.match(C())){var d=this.template;a=C();for(var d=d.split(a).filter(Boolean),
b={},e=0,f,k,g=d.length;e<g;e++)d[e].match(a)&&(f=B(d[e].substring(d[e].indexOf("<"),d[e].indexOf("}}"))+"}").replace(/[<>]/g,""),0===f.indexOf("/")&&b[f.replace("/","")]?(f=f.replace("/",""),k=Object.keys(b[f],"array"),0!==k.length&&(k=k[k.length-1],d[k]="\x3c!--"+d[k],b[f].splice(parseInt(k,10),1),d[e]+="--\x3e",k=Object.keys(b[f],"array"),0===k.length&&(b[f]=null,delete b[f]))):(b[f]||(b[f]=[]),b[f][e]=d[e]));e=0;k=Object.keys(b);for(g=k.length;e<g;e++)for(a=Object.keys(b[k[e]],"array");e<g;e++)d[a[0]]=
"\x3c!--"+d[a[0]]+"--\x3e";this.template=d.join("")}}function p(a,d,b,e){return{value:a,writable:!!d,enumerable:!!e,configurable:!!b}}function F(){return new RegExp("(\\"+t.split("").join("\\")+")(.*?)(\\"+u.split("").join("\\")+")","g")}function C(){return new RegExp("(<\\"+t.split("").join("\\")+".*?\\"+u.split("").join("\\")+".*?>|<\\/\\"+t.split("").join("\\")+".*?\\"+u.split("").join("\\")+">)")}function D(a){return a.split(new RegExp("("+t.split("").join("\\")+")(.*?)("+u.split("").join("\\")+
")","g")).map(function(a,b,e){return e[b-1]===t?t+a+u:a}).filter(function(a,b,e){return 0!==a.length&&a!==t&&a!==u&&0!==a.length})}function B(a){return a.replace(new RegExp("["+t+u+"]","g"),"").replace(new RegExp("(\\"+v.split("").join("\\")+"(.*?)+)","g"),"").replace(/\s/g,"")}function K(a){return a.reduce(function(a,b){b.match(/(\()(.*?)(\))/)?a.vmFilters[a.vmFilters.length]=b.replace(/[\(\)]/g,""):b.match(/(\[)(.*?)(\])/)?-1!==b.indexOf("~")?a.model[a.model.length]=b.replace(/[\[\]\~]/g,""):-1!==
b.indexOf("+")?a.local[a.local.length]=b.replace(/[\[\]\+]/g,""):a.session[a.session.length]=b.replace(/[\[\]\-]/g,""):a.filters[a.filters.length]=b;return a},{filters:[],vmFilters:[],model:[],local:[],session:[]})}function G(a){return-1!==a.indexOf("for")?a.replace(new RegExp("["+t+u+"]","g"),"").replace(/\|(.*)/,"").replace(/\s/g,"").split(/for(.*?)loop/).filter(function(a){return 0!==a.length}):[]}function L(a){if(2>a.split("==").length&&2>a.split("<=").length&&2>a.split(">=").length&&-1!==a.indexOf("="))return a.substring(a.indexOf("=")+
1,a.length)}function M(a){var d=a.match(/^(\s*)(>)((.*?)+)/),b=a.match(/^(\s*)(<)((.*?)+)/);a=a.replace(/(^<|^>)((.*?)+)/,"$2");var e=L(a),f=a.match(/((==|<=|>=|<|>)((.*?)+))/g),k=a.match(/(([\+\*-\/])((.*?)+))/g);return{type:d?"insert":b?"outsert":void 0,set:e!==a?e:void 0,filters:f||k?{boolFilter:f?eval("(function(){ return function(v){ return (v"+f[0]+");};}())"):void 0,mathFilter:k?eval("(function(){ return function(v){ return (v"+k[0]+");};}())"):void 0}:void 0}}function H(a){if(0!==a.length){for(var d=
"",b=0,e=a.length;b<e;b++)if("string"===typeof a[b])d+=a[b];else if(void 0===a[b]._data)d+=a[b].text;else var f=a[b]._data.get(a[b].key),d=d+z(void 0!==f?f:"",a[b].filters.filters,a[b]._data.filters);return d}return z(a[0]._data.get(a[0].key)||"",a[0].filters.filters,a[0]._data.filters)}function z(a,d,b){for(var e=0,f=d.length;e<f;e++)b[d[e]]&&(a=b[d[e]](a));return a}function I(a,d,b,e){for(var f=0,k=d.length;f<k;f++)if(b[d[f]])b[d[f]](a,e);return a}function E(){function a(a,b){var c=M(b);this.text=
a;this.key=b.replace(/(^>|^<*)(.*?)([=*+-\/<>]+)((.*?)+)/g,"$2").replace(/\s/g,"");this.keyLength=this.key.split(".").length;this.localKey=this.key.split(".").pop();var d;d=-1!==a.indexOf(v)?a.replace(new RegExp("["+u+"]","g"),"").replace(new RegExp("(.*?)(\\"+v.split("").join("\\")+")"),"").replace(/\s/g,"").split(","):[];this.filters=K(d);this.component="for"===this.type?G(a)[1]:void 0;this.id=0;this.subType=c.subtype;this.set=c.set;this.inlineFilters=c.filters;this.isBase=!1}function d(a,b){for(var c=
0,d=b.length;c<d;c++)a.stopChange().appendChild(b[c])}function b(a){if(a&&window.model)return window.model.get(a[0])}function e(a,b){if(b&&0!==b.length&&window.model)for(var c=0,d=b.length;c<d;c++)window.model.set(b[c],a)}function f(a){if(a&&window.localStorage)return localStorage.getItem(a[0])}function k(a,b){if(a&&0!==a.length&&window.localStorage)for(var c=0,d=a.length;c<d;c++)localStorage.setItem(a[c],b)}function g(a){if(a&&window.sessionStorage)return sessionStorage.getItem(a[0])}function l(a,
b){if(a&&0!==a.length&&window.sessionStorage)for(var c=0,d=a.length;c<d;c++)sessionStorage.setItem(a[c],b)}Object.defineProperties(a.prototype,{addPointer:p(function(a){for(var b=document.createElement(this.component),c=I(this._data.getLayer(this.key),this.filters.filters,this._data.filters,a)[a],d=0,e=Object.keys(c,"all"),f=e.length;d<f;d++)b.k_post||(b.k_post={}),b.k_post[e[d]]=c,b.k_post.x=a,b.k_post.loopid=this.component+"_"+a;a>=this.node.children.length?this.node.stopChange().appendChild(b):
this.node.stopChange().insertBefore(b,this.node.children[a]);J({event:"loopitem",node:b,parent:this.node,map:this});return this}),removePointer:p(function(a){for(var b=this.node.children[a].kb_maps,c=0,d=Object.keys(this.node.children[a].kb_viewmodel.pointers),e=d.length;c<e;c++){var f=b[d[c]];if(f)for(var g=0,k=f.length;g<k;g++)f[g].unsync(),f[g]=null,delete f[g]}this.node.stopChange().removeChild(this.node.children[a]);c=0;for(e=this.node.children.length;c<e;c++)this.node.children[c].kb_viewmodel.x=
c,a=this.node.children[c].kb_viewmodel.loopid,this.node.children[c].kb_viewmodel.loopid=a.substring(0,a.lastIndexOf("_")+1)+c;return this}),reapplyPointer:p(function(a){for(var b=this.node.children[a].kb_maps,c=this.node.children[a].kb_viewmodel.loopid,d=0,e=Object.keys(this.node.children[a].kb_viewmodel.pointers),f=e.length;d<f;d++){var g=b[e[d]];if(void 0!==g)for(var k=0,l=g.length;k<l;k++)g[k].reconnect()}this.node.children[a].kb_viewmodel.x=a;this.node.children[a].kb_viewmodel.loopid=c.substring(0,
c.lastIndexOf("_")+1)+a;return this}),connect:p(function(a){var e=this;this._data=a;if("for"!==this.type){if(void 0!==this._data.pointers[this.key]&&void 0!==this._data.pointers[this.key].filters)for(var c=this._data.pointers[this.key].filters.dataFilters,n=0,m=Object.keys(this._data.pointers[this.key].filters.stringFilters),r=m.length;n<r;n++)for(var k=this._data.pointers[this.key].filters.stringFilters[m[n]],l=0,h=k.length;l<h;l++)-1===this.filters[m[n]].indexOf(k[l])&&(this.filters[m[n]].push(k[l]),
-1!==["vmfilters","filters"].indexOf(m[n])&&void 0!==c[k[l]]&&void 0===this._data.filters[k[l]]&&(this._data.filters[k[l]]=c[k[l]]));if(this.insert){this.setDom(this._data.get(this.key));this.unsync();return}this.set&&(c=!isNaN(parseInt(this.set,10))&&parseInt(this.set,10).toString().length===this.set.length,n="true"===this.set.replace(/\s/g,"")||"false"===this.set.replace(/\s/g,""),m=-1!==this.set.indexOf('"')||-1!==this.set.indexOf("'"),(this.set=c?parseInt(this.set,10):n?"true"===this.set.replace(/\s/g,
""):m?this.set.replace(/((\s*\"|\')(.*?)(\"|\'))/g,"$3"):void 0)&&this._data.set(this.key,this.set));if(this.outsert){this.setDom("");this.unsync();return}this.inlineFilters&&(this.inlineFilters.boolFilter?(this.filters.filters.unshift("boolFilter"),this._data.filters.boolFilter=this.inlineFilters.boolFilter):(this.filters.filters.unshift("mathFilter"),this._data.filters.mathFilter=this.inlineFilters.mathFilter));if("component"===this.type)return this.filters.model&&0!==this.filters.model.length?
this._data.stopChange().set(this.key,b(this.filters.model)):this.filters.session&&0!==this.filters.session.length?this._data.stopChange().set(this.key,g(this.filters.session)):this.filters.local&&0!==this.filters.local.length&&this._data.stopChange().set(this.key,f(this.filters.local)),this.node.k_post||(this.node.k_post={}),this.node.k_post[this.attr]={filters:{dataFilters:this._data.filters,stringFilters:this.filters},pointer:this._data.getLayer(this.key),key:this.key.split(".").pop()},this;if("node"===
this.type)return this.isBase&&(this.dataListener=function(a){"delete"===a.event?e.unsync():e.replaceNode()},a.getLayer(this.key).addDataUpdateListener(this.localKey,this.dataListener)),this;this.dataListener=function(a){"delete"===a.event?e.unsync():e.setDom(a.value)};this.isEvent||a.getLayer(this.key).addDataUpdateListener(this.localKey,this.dataListener);if(1===this.bindText.length&&!this.isEvent)if(this.domListener=function(a){e.setData(a.value)},this.node.__kbhtmllistener=!0,"object"===typeof this.listener)for(n=
0,r=this.listener.length;n<r;n++)this.node.addAttrUpdateListener(this.listener[n],this.domListener);else this.node.addAttrUpdateListener(this.listener,this.domListener)}else this.dataListener=function(a){"postset"!==a.type||a.oldValue&&0!==a.oldValue.length||(a.event="create");e.setLoop(a.key,a.event)},a.getLayer(this.key).addDataMethodUpdateListener(this.dataListener);"for"!==this.type&&(this.filters.model&&0!==this.filters.model.length?this._data.stopChange().set(this.key,b(this.filters.model)):
this.filters.session&&0!==this.filters.session.length?this._data.stopChange().set(this.key,g(this.filters.session)):this.filters.local&&0!==this.filters.local.length&&this._data.stopChange().set(this.key,f(this.filters.local)),this.isEvent?(this.dataListener=function(a){e.node.stopChange().removeEventListener(e.attr.replace("on",""),a.oldValue);e.node.stopChange().addEventListener(e.attr.replace("on",""),a.value)},this._data.addDataUpdateListener(this.key,this.dataListener),this.node.addEventListener(this.attr.replace("on",
""),this._data.get(this.key))):"innerHTML"===this.key?(this.node.stopChange().innerHTML="",d(this.node,this._data.innerHTML)):(this.local.stopChange()[this.localAttr]=H(this.bindText),this.isInput&&-1!==["value","checked"].indexOf(this.attr)&&(a=this._data.get(this.key),this.node.stopChange()[this.attr]=void 0!==a?a:"")));return this}),reconnect:p(function(){if("for"!==this.type){if(this._data.getLayer(this.key).removeDataUpdateListener(this.localKey,this.dataListener),1===this.bindText.length)if("object"===
typeof this.listener)for(var a=0,b=this.listener.length;a<b;a++)this.node.removeAttrUpdateListener(this.listener[a],this.domListener);else this.node.removeAttrUpdateListener(this.listener,this.domListener)}else this._data.getLayer(this.key).removeDataMethodUpdateListener(this.extraListener);this.connect(this._data);return this}),createloop:p(function(){this.node.stopChange().innerHTML="";for(var a=0,b=I(this._data.get(this.key),this.filters.filters,this._data.filters).length;a<b;a++)this.setLoop(a,
"create");return this}),setData:p(function(a){a=z(a,this.filters.vmFilters,this._data.filters);this._data.stopChange().set(this.key,a);e(this.filters.model,a);l(this.filters.session,a);k(this.filters.local,a);return this}),setDom:p(function(a){e(this.filters.model,a);l(this.filters.session,a);k(this.filters.local,a);this.isEvent?this.node.stopChange()[this.attr]=this._data.get(this.key):this.isInput&&-1!==["value","checked"].indexOf(this.attr)?this.node.stopChange()[this.attr]=this._data.get(this.key):
"innerHTML"===this.key?(this.node.stopChange().innerHTML="",d(this.node,this._data.innerHTML)):(this.local.stopChange()[this.localAttr]=H(this.bindText),this.isInput&&-1!==["value","checked"].indexOf(this.attr)&&(a=this._data.get(this.key),this.node.stopChange()[this.attr]=void 0!==a?a:""));return this}),setLoop:p(function(a,b){switch(b){case "create":this.addPointer(a);break;case "delete":this.removePointer(a);break;case "set":this.reapplyPointer(a);break;default:if("push"!==b)for(var c=0,d=this._data.getLayer(this.key).length;c<
d;c++)this.reapplyPointer(c)}return this}),bindMaps:p([]),unsync:p(function(){this._data=this.__proto__.bindText=null;delete this._data;this.bindMaps=null;delete this.bindMaps;this.binds=null;delete this.binds;return this}),reset:p(function(){"for"===this.type?this._data.getLayer(this.key).removeDataMethodUpdateListener(this.extraListener).addDataMethodUpdateListener(this.extraListener):this.dataListener&&(this._data.getLayer(this.key).removeDataUpdateListener(this.localKey,this.dataListener).addDataUpdateListener(this.localKey,
this.dataListener),1===this.bindText.length&&this.node.removeAttrUpdateListener(this.listener,this.domListener).addAttrUpdateListener(this.listener,this.domListener))}),replaceNode:p(function(){var a=document.createDocumentFragment(),b=a.appendChild(document.createElement("div")),c,d=!1,e=this;b.innerHTML=this.bindText.map(function(a,b){if("object"===typeof a){if(void 0===a._data)return d=!0,"";if(a.key===e.bindText[1].key){var c=z(a._data.get(a.key),a.filters,a._data.filters)||"unknown";"unkown"===
c&&1===b&&console.error("You attempted to bind a node to %o, which does not exist on %o, with bindText: %o",a.key,a._data,a.base);return c}return z(a._data.get(a.key),a.filters,a._data.filters)}return a}).join("");d||(c=b.children[0],a.replaceChild(c,b),this.base.local.parentElement.stopChange().replaceChild(a,this.base.local),this.base.local=c,J({event:"replaceNode",node:this.base.local,parent:this.node,map:this.base}))})});return a}var t="{{",u="}}",v="|",y={},N=/(<\/.*?>)/g;A().call();var O=Object.keys(HTMLElement.prototype).filter(function(a){return 0===
a.indexOf("on")}).concat(["ontouchstart","ontouchend","ontouchmove"]),w={loopitem:[],replaceNode:[]},J=function(a){for(var d=w[a.event],b=0,e=d.length;b<e;b++)d[b](a)};h.start=function(a){if(void 0===a)return t;t="string"===typeof a?a:t;return h};h.end=function(a){if(void 0===a)return u;u="string"===typeof a?a:u;return h};h.pipe=function(a){if(void 0===a)return v;v="string"===typeof a?a:v;return h};h.getUnknown=function(a){var d=a.match(N).map(function(a){return a.replace(/[<\/>]/g,"")});d.filter(function(a,
e){return 0!==a.indexOf(t)&&document.createElement(a)instanceof HTMLUnknownElement&&-1===d.indexOf(a,e+1)&&void 0===y[a]});return d};h.isRegistered=function(a){return void 0!==y[a]};h.register=function(a,d){void 0===y[a]?(y[a]=d,h.getUnknown(d)):console.error("Class: KonnektMP Method: 'register', A template by the name %o already exists",a);return this};h.addEventListener=function(a,d){void 0!==w[a]?w[a].push(d):console.error("Class: KonnektMP Method: 'addEventListener', No event exists with the name %o",
a);return h};h.removeEventListener=function(a,d){if(void 0!==w[a])for(var b=0,e=w[a].length;b<e;b++)w[a][b].toString()===d.toString()&&w[a].splice(b,1);else console.error("Class: KonnektMP Method: 'removeEventListener', No event exists with the name %o",a);return h};Object.defineProperties(h.prototype,{register:p(h.register),isRegistered:p(h.isRegistered),getUnknown:p(h.getUnknown),map:p(function(a){function d(b,e){for(var f=0,k=b.length;f<k;f++)if(void 0===b[f].kb_maps&&8!==b[f].nodeType){b[f].kb_mapper=
a;b[f].kb_maps=e;if(3===b[f].nodeType){var g=b[f],l=e,q=g.textContent;if(q.match(F())){var h=D(q),c=E();c.prototype.type=q.match(new RegExp("(\\"+t.split("").join("\\")+")(.*?)(for)(.*?)(loop)(.*?)(\\"+u.split("").join("\\")+")","g"))?"for":"text";c.prototype.text=q;c.prototype.bindText=h;c.prototype.listener=["textContent","innerHTML","innerText"];c.prototype.attr="textContent";c.prototype.localAttr="textContent";c.prototype.local=g;c.prototype.node=g.parentElement;c.prototype.binds=l;g=0;for(q=
h.length;g<q;g++)if(0===h[g].indexOf(t)){var n="for"===c.prototype.type?G(h[g])[0]:B(h[g]),m=new c(h[g],n);void 0===l[n]&&(l[n]=[]);m.bindText[g]=m;m.bindMaps.push(m);m.id=l[n].length;l[n].push(m)}}}else for(l=b[f],h=e,c=Array.prototype.slice.call(l.attributes),g=l instanceof HTMLUnknownElement,q=0,n=c.length;q<n;q++)if(c[q].value.match(F())){var m=D(c[q].value),r=E();r.prototype.type=g?"component":"attribute";r.prototype.text=c[q].value;r.prototype.bindText=m;r.prototype.isEvent=-1!==O.indexOf(c[q].name);
r.prototype.isInput="input"===l.tagName.toLowerCase();r.prototype.isRadio=r.prototype.isInput?-1!==["radio","checkbox"].indexOf(l.type):!1;r.prototype.listener=c[q].name;r.prototype.attr=c[q].name;r.prototype.localAttr="value";r.prototype.local=c[q];r.prototype.node=l;r.prototype.binds=h;r.prototype.isEvent&&l.removeAttribute(c[q].name);for(var p=0,w=m.length;p<w;p++)if(0===m[p].indexOf(t)){var v=B(m[p]),x=new r(m[p],v);void 0===h[v]&&(h[v]=[]);x.bindText[p]=x;x.bindMaps.push(x);x.id=h[v].length;
h[v].push(x)}}b[f].childNodes&&0!==b[f].childNodes.length&&(e=d(b[f].childNodes,e))}else if(8===b[f].nodeType&&(g=b[f],l=e,q=g.textContent,q.match(C())))for(h=D(q),c=E(),c.prototype.type="node",c.prototype.text=q,c.prototype.bindText=h,c.prototype.base=h[1],c.prototype.listener="textContent",c.prototype.attr="textContent",c.prototype.localAttr="textContent",c.prototype.local=g,c.prototype.node=g.parentElement,c.prototype.binds=l,c.prototype.replacement=void 0,g=0,q=h.length;g<q;g++)0===h[g].indexOf(t)&&
(n=B(h[g]),m=new c(h[g],n),void 0===l[n]&&(l[n]=[]),m.bindText[g]=m,m.bindMaps.push(m),m.id=l[n].length,1===g&&(c.prototype.base=m,m.isBase=!0),l[n].push(m));return e}return d(a.childNodes,{})})});return h}}(Createkb);"undefined"!==typeof window&&"undefined"!==typeof window.define&&"undefined"!==typeof window.require?define([],function(){return A}):"undefined"!==typeof module&&(module.exports=A);return A}();
